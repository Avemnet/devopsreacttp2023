FROM node:20-alpine as build

WORKDIR /app 

RUN apk add --no-cache libc6-compat

COPY package*.json ./

RUN npm ci --omit=dev

COPY . ./

RUN ls --recursive ./


FROM gcr.io/distroless/nodejs20-debian11

ARG BACKEND_ENDPOINT SENTRY_DSN
ENV BACKEND_ENDPOINT=$BACKEND_ENDPOINT SENTRY_DSN=$SENTRY_DSN


COPY --from=build /app /app

WORKDIR /app

CMD ["npm", "start"]



